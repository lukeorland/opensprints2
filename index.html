<html>

<body>
  <h1>Hello WAMP</h1>
  <p>Open JavaScript console to watch output.</p>
  <script>
    AUTOBAHN_DEBUG = true;
  </script>

  <script>
    var autobahn = require('autobahn');
    // Create a new client connection.
    // See http://autobahn.ws/js/ for reference.
    var client = new autobahn.Connection({
      url: 'ws://localhost:8080/secure-nightlife',
      realm: 'com.example.inge'
    });

    // When client session is established, call 'random integer' service
    // and subscribe to 'time' event.
    client.onopen = function(session) {
      setInterval(function() {
        session.call('com.example.random')
          .then(function(random) {
            console.log('random integer:', random);
          })
          .catch(function(err) {
            console.log('cannot call random service!', err);
          })
          .done();
      }, 1800);

      session.subscribe('com.example.time', function(args, kwargs, details) {
          console.log('current system time:', new Date(args[0]));
        })
        .catch(function(err) {
          console.log('cannot subscribe to topic!', err);
        })
        .done();
    };

    // Open client connection.
    client.open();
  </script>
</body>

</html>
